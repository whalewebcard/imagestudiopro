<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image Studio Pro - Premium Image Processor</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Kanit:wght@200;300;400;500;600;700&display=swap');
        
        :root {
            --primary: #6366f1;
            --primary-hover: #4f46e5;
        }

        body {
            font-family: 'Kanit', sans-serif;
            background: radial-gradient(circle at top right, #f8fafc, #eff6ff);
            min-height: 100vh;
            color: #1e293b;
        }

        .premium-card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.6);
            box-shadow: 0 15px 35px -5px rgba(0, 0, 0, 0.05);
        }

        .drop-zone {
            border: 2px dashed #cbd5e1;
            background: rgba(248, 250, 252, 0.5);
            transition: all 0.3s ease;
        }

        .drop-zone.drag-over {
            border-color: var(--primary);
            background: rgba(99, 102, 241, 0.05);
            transform: scale(1.01);
        }

        input[type=range] {
            -webkit-appearance: none;
            background: transparent;
        }

        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 4px;
            cursor: pointer;
            background: #e2e8f0;
            border-radius: 10px;
        }

        input[type=range]::-webkit-slider-thumb {
            height: 16px;
            width: 16px;
            border-radius: 50%;
            background: var(--primary);
            cursor: pointer;
            -webkit-appearance: none;
            margin-top: -6px;
            box-shadow: 0 2px 4px rgba(99, 102, 241, 0.3);
            border: 2px solid white;
        }

        .format-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(110px, 1fr));
            gap: 8px;
        }

        .format-item {
            transition: all 0.2s ease;
        }

        .format-item.active {
            background-color: var(--primary);
            color: white;
            box-shadow: 0 4px 10px -2px rgba(99, 102, 241, 0.3);
        }

        ::-webkit-scrollbar {
            width: 4px;
        }
        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 10px;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(5px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .animate-fade-in {
            animation: fadeIn 0.4s ease-out forwards;
        }
        
        .external-tool-btn {
            transition: all 0.2s ease;
            border: 1px solid #f1f5f9;
        }
        
        .external-tool-btn:hover {
            border-color: #e2e8f0;
            background-color: #f8fafc;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.03);
        }
    </style>
</head>
<body class="py-6 px-4">
    <div class="max-w-4xl mx-auto">
        <!-- Compact Header -->
        <header class="text-center mb-6 animate-fade-in">
            <h1 class="text-3xl font-extrabold text-slate-900 tracking-tight mb-1">
                Image Studio <span class="text-indigo-500">Pro</span>
            </h1>
            <p class="text-slate-500 text-sm">
                บีบอัดและแปลงไฟล์รูปภาพทันทีบนเครื่องของคุณ <span class="font-medium text-slate-700">ปลอดภัย 100%</span>
            </p>
        </header>

        <main class="premium-card rounded-3xl overflow-hidden">
            <!-- Upload Area -->
            <div id="uploadSection" class="p-6 space-y-6">
                <!-- Drop Zone -->
                <div id="dropZone" class="drop-zone rounded-2xl p-12 text-center cursor-pointer group">
                    <input type="file" id="fileInput" class="hidden" accept="image/*">
                    <div class="space-y-4">
                        <i class="fas fa-cloud-arrow-up text-5xl text-slate-300 group-hover:text-indigo-500 transition-colors duration-300"></i>
                        <div>
                            <p class="text-lg font-semibold text-slate-800">ลากไฟล์รูปภาพมาวางที่นี่</p>
                            <p class="text-slate-400 text-xs mt-1">หรือคลิกเพื่อเลือกไฟล์</p>
                        </div>
                    </div>
                </div>

                <!-- External Tools (Moved to Home Page) -->
                <div class="pt-4 border-t border-slate-100">
                    <div class="flex items-center space-x-2 mb-4">
                        <div class="w-1 h-3 bg-indigo-500 rounded-full"></div>
                        <label class="text-[10px] font-black text-slate-400 uppercase tracking-widest block">เครื่องมือแนะนำเพิ่มเติม</label>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                        <a href="https://convertio.co/th/mp4-mp3/" target="_blank" class="external-tool-btn flex items-center p-4 rounded-2xl bg-white shadow-sm">
                            <div class="w-10 h-10 rounded-xl bg-red-50 flex items-center justify-center mr-4">
                                <i class="fas fa-file-audio text-red-500 text-lg"></i>
                            </div>
                            <div class="flex-grow">
                                <p class="text-sm font-bold text-slate-700">แปลงวิดีโอเป็น MP3</p>
                                <p class="text-[10px] text-slate-400">Convert MP4 to MP3</p>
                            </div>
                            <i class="fas fa-external-link-alt text-[10px] text-slate-300"></i>
                        </a>
                        <a href="https://www.iloveimg.com/th/compress-image/compress-gif" target="_blank" class="external-tool-btn flex items-center p-4 rounded-2xl bg-white shadow-sm">
                            <div class="w-10 h-10 rounded-xl bg-orange-50 flex items-center justify-center mr-4">
                                <i class="fas fa-film text-orange-500 text-lg"></i>
                            </div>
                            <div class="flex-grow">
                                <p class="text-sm font-bold text-slate-700">บีบอัดไฟล์ GIF</p>
                                <p class="text-[10px] text-slate-400">Compress Animated GIF</p>
                            </div>
                            <i class="fas fa-external-link-alt text-[10px] text-slate-300"></i>
                        </a>
                    </div>
                </div>
            </div>

            <!-- Workspace Area -->
            <div id="editorSection" class="hidden grid grid-cols-1 lg:grid-cols-12">
                <!-- Preview Area -->
                <div class="lg:col-span-7 p-5 bg-slate-50/50 flex flex-col border-b lg:border-b-0 lg:border-r border-slate-100">
                    <div class="flex items-center justify-between mb-4">
                        <div class="flex items-center space-x-2">
                            <span class="w-2 h-2 bg-green-500 rounded-full"></span>
                            <span class="text-xs font-bold text-slate-600 uppercase tracking-tight">Live Preview</span>
                        </div>
                        <span id="fileInfoDisplay" class="bg-indigo-50 text-indigo-600 px-2 py-0.5 rounded text-[10px] font-bold font-mono">-</span>
                    </div>

                    <div id="previewContainer" class="relative rounded-2xl overflow-hidden bg-white border border-slate-100 shadow-sm flex-grow min-h-[300px] flex items-center justify-center">
                        <img id="previewEl" class="max-w-full max-h-full object-contain p-2" src="" alt="Preview">
                        <div id="loader" class="absolute inset-0 bg-white/70 backdrop-blur-sm flex items-center justify-center hidden z-20">
                            <div class="flex flex-col items-center">
                                <i class="fas fa-circle-notch fa-spin text-indigo-500 text-2xl mb-2"></i>
                                <span id="loaderMsg" class="text-[10px] font-bold text-slate-500 uppercase tracking-widest text-center px-4">Processing...</span>
                            </div>
                        </div>
                    </div>

                    <div class="grid grid-cols-2 gap-3 mt-4">
                        <div class="p-4 bg-white rounded-2xl border border-slate-100">
                            <p class="text-[9px] text-slate-400 uppercase font-black tracking-widest mb-1">ต้นฉบับ</p>
                            <p id="originalSize" class="text-lg font-bold text-slate-700">-</p>
                        </div>
                        <div class="p-4 bg-indigo-600 rounded-2xl shadow-md">
                            <p class="text-[9px] text-indigo-200 uppercase font-black tracking-widest mb-1">ผลลัพธ์</p>
                            <p id="compressedSize" class="text-lg font-bold text-white">-</p>
                        </div>
                    </div>
                </div>

                <!-- Control Panel -->
                <div class="lg:col-span-5 p-6 bg-white flex flex-col space-y-6">
                    <div class="space-y-5">
                        <h2 class="text-sm font-black text-slate-800 uppercase tracking-wider flex items-center">
                            <i class="fas fa-cog mr-2 text-indigo-500"></i> Settings
                        </h2>

                        <div class="space-y-4">
                            <div class="space-y-3">
                                <div class="flex justify-between items-center text-xs">
                                    <label class="font-bold text-slate-500">Scale (ปรับขนาด)</label>
                                    <span id="scaleLabel" class="font-black text-indigo-600">100%</span>
                                </div>
                                <input type="range" id="scaleSlider" min="10" max="100" value="100" step="5" class="w-full">
                            </div>

                            <div class="space-y-3">
                                <div class="flex justify-between items-center text-xs">
                                    <label class="font-bold text-slate-500">Quality (คุณภาพ)</label>
                                    <span id="qualityLabel" class="font-black text-indigo-600">80%</span>
                                </div>
                                <input type="range" id="qualitySlider" min="5" max="100" value="80" class="w-full">
                            </div>
                        </div>

                        <div class="space-y-3">
                            <label class="text-xs font-bold text-slate-500 block">Format (นามสกุล)</label>
                            <div class="relative mb-2">
                                <i class="fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-slate-300 text-[10px]"></i>
                                <input type="text" id="formatSearch" placeholder="Search..." class="w-full pl-8 pr-3 py-2 bg-slate-50 border border-slate-100 rounded-xl text-xs focus:ring-1 focus:ring-indigo-400 outline-none transition-all">
                            </div>
                            <div id="formatOptionsList" class="format-grid max-h-[160px] overflow-y-auto pr-1">
                            </div>
                        </div>
                    </div>

                    <div class="pt-2 mt-auto">
                        <button id="downloadBtn" class="w-full bg-slate-900 hover:bg-black text-white font-bold py-3.5 rounded-2xl transition-all flex items-center justify-center text-sm shadow-lg active:scale-95">
                            <i class="fas fa-download mr-2"></i> DOWNLOAD
                        </button>
                        <button id="resetBtn" class="w-full text-slate-400 hover:text-indigo-500 font-bold py-2 mt-2 text-[10px] uppercase tracking-widest transition-colors">
                            <i class="fas fa-arrow-left mr-1"></i> New File
                        </button>
                    </div>
                </div>
            </div>
        </main>
        
        <footer class="mt-6 text-center text-slate-400 text-[10px]">
            <p>© 2026 Image Studio Pro • Private & Offline Processor</p>
        </footer>
    </div>

    <div id="toast" class="fixed bottom-6 left-1/2 -translate-x-1/2 translate-y-20 transition-all duration-300 opacity-0 z-50">
        <div class="bg-slate-900 text-white px-6 py-2.5 rounded-full shadow-xl flex items-center space-x-2 border border-slate-800">
            <i class="fas fa-check text-green-400 text-xs"></i>
            <span id="toastText" class="font-bold text-xs">Success</span>
        </div>
    </div>

    <script>
        const formatOptions = [
            { id: 'image/jpeg', label: 'JPEG', ext: '.jpg', icon: 'fa-file-image' },
            { id: 'image/png', label: 'PNG', ext: '.png', icon: 'fa-file-code' },
            { id: 'image/webp', label: 'WebP', ext: '.webp', icon: 'fa-bolt' },
            { id: 'image/avif', label: 'AVIF', ext: '.avif', icon: 'fa-magic' },
            { id: 'image/bmp', label: 'BMP', ext: '.bmp', icon: 'fa-cube' },
            { id: 'image/tiff', label: 'TIFF', ext: '.tiff', icon: 'fa-print' },
            { id: 'image/x-icon', label: 'ICO', ext: '.ico', icon: 'fa-window-maximize' }
        ];

        const el = {
            dropZone: document.getElementById('dropZone'),
            fileInput: document.getElementById('fileInput'),
            uploadSection: document.getElementById('uploadSection'),
            editorSection: document.getElementById('editorSection'),
            previewEl: document.getElementById('previewEl'),
            originalSize: document.getElementById('originalSize'),
            compressedSize: document.getElementById('compressedSize'),
            qualitySlider: document.getElementById('qualitySlider'),
            qualityLabel: document.getElementById('qualityLabel'),
            scaleSlider: document.getElementById('scaleSlider'),
            scaleLabel: document.getElementById('scaleLabel'),
            downloadBtn: document.getElementById('downloadBtn'),
            resetBtn: document.getElementById('resetBtn'),
            fileInfoDisplay: document.getElementById('fileInfoDisplay'),
            loader: document.getElementById('loader'),
            toast: document.getElementById('toast'),
            toastText: document.getElementById('toastText'),
            formatSearch: document.getElementById('formatSearch'),
            formatOptionsList: document.getElementById('formatOptionsList')
        };

        let state = {
            originalFile: null,
            originalImage: null,
            currentUrl: null,
            compressedBlob: null,
            selectedFormat: 'image/jpeg',
            isProcessing: false
        };

        function renderFormatList(filter = '') {
            el.formatOptionsList.innerHTML = '';
            const filtered = formatOptions.filter(o => 
                o.label.toLowerCase().includes(filter.toLowerCase()) || 
                o.ext.toLowerCase().includes(filter.toLowerCase())
            );

            filtered.forEach(opt => {
                const isActive = state.selectedFormat === opt.id;
                const card = document.createElement('div');
                card.className = `format-item flex flex-col items-center justify-center p-2.5 rounded-xl border cursor-pointer ${isActive ? 'active' : 'bg-slate-50 border-slate-100 hover:border-indigo-200'}`;
                card.innerHTML = `
                    <i class="fas ${opt.icon} mb-1 text-sm ${isActive ? 'text-white' : 'text-slate-400'}"></i>
                    <span class="text-[10px] font-bold">${opt.label}</span>
                `;
                card.onclick = () => {
                    if (state.isProcessing) return;
                    state.selectedFormat = opt.id;
                    renderFormatList(el.formatSearch.value);
                    processImage();
                };
                el.formatOptionsList.appendChild(card);
            });
        }

        el.formatSearch.oninput = (e) => renderFormatList(e.target.value);
        el.dropZone.onclick = () => el.fileInput.click();
        el.dropZone.ondragover = (e) => { e.preventDefault(); el.dropZone.classList.add('drag-over'); };
        el.dropZone.ondragleave = () => el.dropZone.classList.remove('drag-over');
        el.dropZone.ondrop = (e) => {
            e.preventDefault();
            el.dropZone.classList.remove('drag-over');
            if (e.dataTransfer.files.length) handleFile(e.dataTransfer.files[0]);
        };

        el.fileInput.onchange = (e) => { if(e.target.files.length) handleFile(e.target.files[0]); };
        el.qualitySlider.oninput = (e) => { el.qualityLabel.textContent = `${e.target.value}%`; processImage(); };
        el.scaleSlider.oninput = (e) => { el.scaleLabel.textContent = `${e.target.value}%`; processImage(); };
        el.resetBtn.onclick = () => location.reload();

        el.downloadBtn.onclick = () => {
            if (!state.compressedBlob || state.isProcessing) return;
            const link = document.createElement('a');
            link.href = URL.createObjectURL(state.compressedBlob);
            const selectedOpt = formatOptions.find(o => o.id === state.selectedFormat);
            link.download = `Studio_Pro_${Date.now()}${selectedOpt.ext}`;
            link.click();
            showToast('Download complete!');
        };

        function handleFile(file) {
            if (!file.type.startsWith('image/')) return showToast('กรุณาเลือกไฟล์รูปภาพ');
            
            state.originalFile = file;
            el.originalSize.textContent = formatSize(file.size);
            renderFormatList();

            const reader = new FileReader();
            reader.onload = (e) => {
                const img = new Image();
                img.onload = () => {
                    state.originalImage = img;
                    el.uploadSection.classList.add('hidden');
                    el.editorSection.classList.remove('hidden');
                    el.editorSection.classList.add('animate-fade-in');
                    processImage();
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);
        }

        let timer;
        async function processImage() {
            if (!state.originalImage || state.isProcessing) return;
            
            clearTimeout(timer);
            timer = setTimeout(async () => {
                renderCanvas();
            }, 100);
        }

        function renderCanvas() {
            state.isProcessing = true;
            el.loader.classList.remove('hidden');
            
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            const scale = el.scaleSlider.value / 100;
            const w = Math.max(1, Math.round(state.originalImage.width * scale));
            const h = Math.max(1, Math.round(state.originalImage.height * scale));
            canvas.width = w; canvas.height = h;
            
            ctx.imageSmoothingEnabled = true;
            ctx.imageSmoothingQuality = 'high';
            ctx.drawImage(state.originalImage, 0, 0, w, h);
            
            canvas.toBlob((blob) => {
                updateResult(blob, w, h);
                state.isProcessing = false;
            }, state.selectedFormat, el.qualitySlider.value / 100);
        }

        function updateResult(blob, w, h) {
            if (!blob) return;
            state.compressedBlob = blob;
            el.compressedSize.textContent = formatSize(blob.size);
            el.fileInfoDisplay.textContent = `${w}x${h}`;
            
            const reduction = ((1 - (blob.size / state.originalFile.size)) * 100).toFixed(0);
            if (reduction > 0) {
                el.compressedSize.innerHTML = `${formatSize(blob.size)} <span class="text-[9px] bg-white/20 px-1.5 py-0.5 rounded-full ml-1 font-bold">-${reduction}%</span>`;
            } else {
                el.compressedSize.textContent = formatSize(blob.size);
            }

            if (state.currentUrl) URL.revokeObjectURL(state.currentUrl);
            state.currentUrl = URL.createObjectURL(blob);
            el.previewEl.src = state.currentUrl;
            el.loader.classList.add('hidden');
        }

        function formatSize(b) {
            if (!b || b === 0) return '0 B';
            const k = 1024, i = Math.floor(Math.log(b) / Math.log(k));
            return parseFloat((b / Math.pow(k, i)).toFixed(1)) + ' ' + ['B', 'KB', 'MB', 'GB'][i];
        }

        function showToast(t) {
            el.toastText.textContent = t;
            el.toast.classList.remove('translate-y-20', 'opacity-0');
            setTimeout(() => el.toast.classList.add('translate-y-20', 'opacity-0'), 2500);
        }

        renderFormatList();
    </script>
</body>
</html>
